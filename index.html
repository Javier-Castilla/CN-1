<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookstore API Tester</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .url-config { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; }
        .url-config h3 { color: #667eea; margin-bottom: 15px; }
        .url-input-group { display: flex; gap: 10px; }
        .url-input-group input { flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; }
        .url-input-group button { padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
        .tab:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        .tab.active { background: white; color: #667eea; }
        .content { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .section { margin-bottom: 40px; }
        .section h3 { color: #667eea; margin-bottom: 20px; font-size: 1.5em; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #333; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .form-group input:disabled { background: #f0f0f0; cursor: not-allowed; }
        .form-group textarea { resize: vertical; min-height: 80px; font-family: 'Courier New', monospace; }
        .form-group select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin-right: 10px; margin-bottom: 10px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-danger { background: #f56565; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .btn-secondary { background: #718096; color: white; }
        .btn-small { padding: 8px 16px; font-size: 14px; margin: 5px 5px 0 0; }
        .result { margin-bottom: 30px; padding: 20px; border-radius: 8px; background: #f7fafc; border-left: 4px solid #667eea; }
        .result h4 { margin-bottom: 10px; color: #667eea; }
        .result pre { background: #2d3748; color: #68d391; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 14px; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .data-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s; position: relative; }
        .data-card:hover { transform: translateY(-5px); }
        .data-card.selected { border: 3px solid #48bb78; box-shadow: 0 0 0 3px rgba(72,187,120,0.3); cursor: pointer; }
        .data-card h4 { margin-bottom: 10px; font-size: 1.2em; }
        .data-card p { margin: 5px 0; font-size: 0.9em; }
        .card-actions { margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap; }
        .error { background: #fed7d7; color: #c53030; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .success { background: #c6f6d5; color: #22543d; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .two-column { grid-template-columns: 1fr; } }
        .order-items { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.85em; }
        .order-item { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .order-item:last-child { border-bottom: none; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 15px; }
        .modal-header h3 { color: #667eea; margin: 0; }
        .modal-close { background: none; border: none; font-size: 28px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; }
        .modal-close:hover { color: #333; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .results-section { margin-bottom: 30px; }
        .empty-state { text-align: center; padding: 40px; color: #999; }
        .empty-state svg { width: 80px; height: 80px; margin-bottom: 15px; opacity: 0.3; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìö Bookstore API Tester</h1>
        <p>Interfaz de prueba para tu API REST de Spring Boot</p>
    </div>

    <div class="url-config">
        <h3>üîó Configuraci√≥n de la API</h3>
        <div class="url-input-group">
            <input type="text" id="baseUrl" value="http://localhost:8080" placeholder="URL base de la API">
            <input type="text" id="apiKey" placeholder="API Key (opcional)" style="flex: 0.7;">
            <button id="saveUrlBtn">Guardar</button>
        </div>
        <p style="margin-top: 10px; color: #666; font-size: 14px;">
            URL: <strong id="currentUrl">http://localhost:8080</strong> |
            API Key: <strong id="currentApiKey">No configurada</strong>
        </p>
    </div>

    <div class="tabs">
        <button class="tab active" data-tab="books">üìñ Libros</button>
        <button class="tab" data-tab="customers">üë• Clientes</button>
        <button class="tab" data-tab="orders">üõí Pedidos</button>
        <button class="tab" data-tab="customer-orders">üì¶ Pedidos por Cliente</button>
    </div>

    <div class="content">
        <!-- LIBROS -->
        <div id="books" class="tab-content active">
            <div class="results-section">
                <div id="booksResult" class="result" style="display: none;"></div>
                <div id="booksGrid" class="data-grid"></div>
            </div>
            <div class="section">
                <h3>üìö Gesti√≥n de Libros</h3>
                <button class="btn btn-primary" id="getAllBooksBtn">üìã Ver Todos los Libros</button>
                <button class="btn btn-success" id="showCreateBookBtn">‚ûï Crear Nuevo Libro</button>
            </div>
        </div>

        <!-- CLIENTES -->
        <div id="customers" class="tab-content">
            <div class="results-section">
                <div id="customersResult" class="result" style="display: none;"></div>
                <div id="customersGrid" class="data-grid"></div>
            </div>
            <div class="section">
                <h3>üë• Gesti√≥n de Clientes</h3>
                <button class="btn btn-primary" id="getAllCustomersBtn">üìã Ver Todos</button>
                <button class="btn btn-success" id="showCreateCustomerBtn">‚ûï Crear Cliente</button>
            </div>
        </div>

        <!-- PEDIDOS -->
        <div id="orders" class="tab-content">
            <div class="results-section">
                <div id="ordersResult" class="result" style="display: none;"></div>
                <div id="ordersGrid" class="data-grid"></div>
            </div>
            <div class="section">
                <h3>üõí Gesti√≥n de Pedidos</h3>
                <button class="btn btn-primary" id="getAllOrdersBtn">üìã Ver Todos los Pedidos</button>
                <button class="btn btn-success" id="showCreateOrderBtn">‚ûï Crear Pedido</button>
            </div>
        </div>

        <!-- PEDIDOS POR CLIENTE -->
        <div id="customer-orders" class="tab-content">
            <div class="results-section">
                <div id="customerOrdersResult" class="result" style="display: none;"></div>
                <div id="customerOrdersGrid" class="data-grid"></div>
            </div>
            <div class="section">
                <h3>üì¶ Pedidos por Cliente</h3>
                <input type="number" id="customerOrdersId" placeholder="ID del cliente" style="padding:10px; width:200px;">
                <button class="btn btn-primary" id="searchCustomerOrdersBtn">Buscar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Modal</h3>
            <button class="modal-close" id="closeModalBtn">&times;</button>
        </div>
        <div id="modalBody"></div>
    </div>
</div>

<script>
    let baseUrl = 'http://localhost:8080';
    let apiKey = '';

    /* ===========================
       TABS
    =========================== */
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.dataset.tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        });
    });

    /* ===========================
       URL CONFIG
    =========================== */
    document.getElementById('saveUrlBtn').addEventListener('click', () => {
        baseUrl = document.getElementById('baseUrl').value.trim().replace(/\/$/, '');
        apiKey = document.getElementById('apiKey').value.trim();
        document.getElementById('currentUrl').textContent = baseUrl;
        document.getElementById('currentApiKey').textContent = apiKey ? '***' + apiKey.slice(-4) : 'No configurada';
        showMsg('Configuraci√≥n guardada correctamente', 'success');
    });

    function scrollToResults() {
        const active = document.querySelector('.tab-content.active .results-section');
        if (active) active.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function showResult(id, data) {
        const el = document.getElementById(id);
        el.style.display = 'block';
        el.innerHTML = `<h4>‚úÖ Respuesta:</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
        scrollToResults();
    }

    function showMsg(msg, type='success') {
        const activeTab = document.querySelector('.tab-content.active');
        const resultId = activeTab.id + 'Result';
        const el = document.getElementById(resultId);
        el.style.display = 'block';
        el.innerHTML = `<div class="${type}">${msg}</div>`;
        scrollToResults();
        setTimeout(()=>el.style.display='none', 3000);
    }

    function showError(id, msg) {
        const el = document.getElementById(id);
        el.style.display = 'block';
        el.innerHTML = `<div class="error">‚ùå ${msg}</div>`;
        scrollToResults();
    }

    async function req(url, method='GET', body=null) {
        const opts = {
            method,
            headers: {'Content-Type':'application/json'},
            mode:'cors'
        };

        if(apiKey) {
            opts.headers['Authorization'] = `Bearer ${apiKey}`;
        }

        if(body) opts.body = JSON.stringify(body);
        const res = await fetch(url, opts);
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
    }

    /* ===========================
       MODAL
    =========================== */
    function openModal(title, bodyHTML) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalBody').innerHTML = bodyHTML;
        document.getElementById('modal').classList.add('show');
        // Dar foco al primer input despu√©s de un peque√±o delay
        setTimeout(() => {
            const firstInput = document.querySelector('#modalBody input:not([disabled])');
            if(firstInput) firstInput.focus();
        }, 100);
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('show');
    }

    document.getElementById('closeModalBtn').addEventListener('click', closeModal);

    document.getElementById('modal').addEventListener('click', function(e) {
        if(e.target === this) closeModal();
    });

    /* ===========================
       LIBROS
    =========================== */
    document.getElementById('getAllBooksBtn').addEventListener('click', async ()=>{
        try{
            const data = await req(`${baseUrl}/books`);
            displayBooksGrid(data);
        }catch(e){ showError('booksResult', e.message); }
    });

    document.getElementById('showCreateBookBtn').addEventListener('click', ()=>{
        openModal('‚ûï Crear Libro', `
        <div class="form-group"><label>ISBN *</label><input type="text" id="bookIsbn"></div>
        <div class="form-group"><label>T√≠tulo *</label><input type="text" id="bookTitle"></div>
        <div class="form-group"><label>Autor *</label><input type="text" id="bookAuthor"></div>
        <div class="form-group"><label>Editorial</label><input type="text" id="bookPublisher"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-success" onclick="createBook()">Crear</button>
        </div>
    `);
    });

    async function createBook(){
        const book = {
            isbn: document.getElementById('bookIsbn').value.trim(),
            title: document.getElementById('bookTitle').value.trim(),
            author: document.getElementById('bookAuthor').value.trim(),
            publisher: document.getElementById('bookPublisher').value.trim()
        };
        if(!book.isbn || !book.title || !book.author) return alert('Completa los campos obligatorios');
        try{
            await req(`${baseUrl}/books`, 'POST', book);
            closeModal();
            showMsg('Libro creado correctamente');
            document.getElementById('getAllBooksBtn').click();
        }catch(e){ alert(e.message); }
    }

    function editBook(book){
        openModal('‚úèÔ∏è Editar Libro', `
        <div class="form-group"><label>ISBN</label><input value="${book.isbn}" disabled style="background:#f0f0f0"></div>
        <div class="form-group"><label>T√≠tulo</label><input id="bookTitleEdit" value="${book.title}"></div>
        <div class="form-group"><label>Autor</label><input id="bookAuthorEdit" value="${book.author}"></div>
        <div class="form-group"><label>Editorial</label><input id="bookPublisherEdit" value="${book.publisher}"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-success" onclick="updateBook('${book.isbn}')">Actualizar</button>
        </div>
    `);
    }

    async function updateBook(isbn){
        const book = {
            title: document.getElementById('bookTitleEdit').value.trim(),
            author: document.getElementById('bookAuthorEdit').value.trim(),
            publisher: document.getElementById('bookPublisherEdit').value.trim()
        };
        try{
            await req(`${baseUrl}/books/${isbn}`, 'PUT', book);
            closeModal();
            showMsg('Libro actualizado correctamente');
            document.getElementById('getAllBooksBtn').click();
        }catch(e){ alert(e.message); }
    }

    async function deleteBook(isbn){
        if(!confirm('¬øEliminar este libro?')) return;
        try{
            await req(`${baseUrl}/books/${isbn}`, 'DELETE');
            showMsg('Libro eliminado correctamente');
            document.getElementById('getAllBooksBtn').click();
        }catch(e){ alert(e.message); }
    }

    function displayBooksGrid(data){
        const grid = document.getElementById('booksGrid');
        if(!data || data.length===0) { grid.innerHTML='<div class="empty-state">No hay libros</div>'; return; }
        grid.innerHTML='';
        data.forEach(book=>{
            const div = document.createElement('div');
            div.className='data-card';
            const bookData = JSON.stringify(book).replace(/'/g, "&#39;").replace(/"/g, '&quot;');
            div.innerHTML = `<h4>${book.title}</h4>
                         <p>ISBN: ${book.isbn}</p>
                         <p>Autor: ${book.author}</p>
                         <p>Editorial: ${book.publisher||'-'}</p>
                         <div class="card-actions">
                            <button class="btn btn-small btn-warning" onclick='editBook(${bookData})'>Editar</button>
                            <button class="btn btn-small btn-danger" onclick="deleteBook('${book.isbn}')">Eliminar</button>
                         </div>`;
            grid.appendChild(div);
        });
    }

    /* ===========================
       CLIENTES
    =========================== */
    document.getElementById('getAllCustomersBtn').addEventListener('click', async ()=>{
        try{
            const data = await req(`${baseUrl}/customers`);
            displayCustomersGrid(data);
        }catch(e){ showError('customersResult', e.message); }
    });

    document.getElementById('showCreateCustomerBtn').addEventListener('click', ()=>{
        openModal('‚ûï Crear Cliente', `
        <div class="form-group"><label>Nombre *</label><input type="text" id="customerName"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="customerEmail"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-success" onclick="createCustomer()">Crear</button>
        </div>
    `);
    });

    async function createCustomer(){
        const customer = {
            name: document.getElementById('customerName').value.trim(),
            email: document.getElementById('customerEmail').value.trim()
        };
        if(!customer.name||!customer.email) return alert('Completa los campos obligatorios');
        try{
            await req(`${baseUrl}/customers`, 'POST', customer);
            closeModal();
            showMsg('Cliente creado correctamente');
            document.getElementById('getAllCustomersBtn').click();
        }catch(e){ alert(e.message); }
    }

    function editCustomer(c){
        openModal('‚úèÔ∏è Editar Cliente', `
        <div class="form-group"><label>ID</label><input value="${c.id}" disabled style="background:#f0f0f0"></div>
        <div class="form-group"><label>Nombre</label><input type="text" id="customerNameEdit" value="${c.name}"></div>
        <div class="form-group"><label>Email</label><input type="email" id="customerEmailEdit" value="${c.email}"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-success" onclick="updateCustomer(${c.id})">Actualizar</button>
        </div>
    `);
    }

    async function updateCustomer(id){
        const customer = {
            name: document.getElementById('customerNameEdit').value.trim(),
            email: document.getElementById('customerEmailEdit').value.trim()
        };
        try{
            await req(`${baseUrl}/customers/${id}`, 'PUT', customer);
            closeModal();
            showMsg('Cliente actualizado correctamente');
            document.getElementById('getAllCustomersBtn').click();
        }catch(e){ alert(e.message); }
    }

    async function deleteCustomer(id){
        if(!confirm('¬øEliminar este cliente?')) return;
        try{
            await req(`${baseUrl}/customers/${id}`, 'DELETE');
            showMsg('Cliente eliminado correctamente');
            document.getElementById('getAllCustomersBtn').click();
        }catch(e){ alert(e.message); }
    }

    function displayCustomersGrid(data){
        const grid = document.getElementById('customersGrid');
        if(!data || data.length===0) { grid.innerHTML='<div class="empty-state">No hay clientes</div>'; return; }
        grid.innerHTML='';
        data.forEach(c=>{
            const div = document.createElement('div');
            div.className='data-card';
            const customerData = JSON.stringify(c).replace(/'/g, "&#39;").replace(/"/g, '&quot;');
            div.innerHTML = `<h4>${c.name}</h4>
                         <p>ID: ${c.id}</p>
                         <p>Email: ${c.email}</p>
                         <div class="card-actions">
                            <button class="btn btn-small btn-warning" onclick='editCustomer(${customerData})'>Editar</button>
                            <button class="btn btn-small btn-danger" onclick="deleteCustomer(${c.id})">Eliminar</button>
                         </div>`;
            grid.appendChild(div);
        });
    }

    /* ===========================
       PEDIDOS
    =========================== */
    let allBooksCache=[], allCustomersCache=[];

    document.getElementById('getAllOrdersBtn').addEventListener('click', async ()=>{
        try{
            const data = await req(`${baseUrl}/orders`);
            displayOrdersGrid(data);
        }catch(e){ showError('ordersResult', e.message); }
    });

    document.getElementById('showCreateOrderBtn').addEventListener('click', async ()=>{
        try{
            allBooksCache = await req(`${baseUrl}/books`);
            allCustomersCache = await req(`${baseUrl}/customers`);
            openCreateOrderModal();
        }catch(e){ alert(e.message); }
    });

    function openCreateOrderModal(){
        let booksHTML = allBooksCache.map(b=>`
        <div class="data-card" data-isbn="${b.isbn}" style="cursor:pointer;">
            <h4>${b.title}</h4>
            <p>Autor: ${b.author}</p>
            <p>Editorial: ${b.publisher||'-'}</p>
            <div class="form-group" onclick="event.stopPropagation();">
                <label>Cantidad</label>
                <input type="number" value="1" min="1" class="book-qty" style="width:80px;">
            </div>
        </div>
    `).join('');
        let customersHTML = allCustomersCache.map(c=>`<option value="${c.id}">${c.name} (ID: ${c.id})</option>`).join('');
        openModal('‚ûï Crear Pedido', `
        <div class="form-group">
            <label>Cliente</label>
            <select id="orderCustomer">${customersHTML}</select>
        </div>
        <div class="form-group">
            <label>Libros (haz clic para seleccionar)</label>
            <div id="orderBooksGrid" class="data-grid">${booksHTML}</div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-success" onclick="createOrder()">Crear Pedido</button>
        </div>
    `);

        setTimeout(() => {
            document.querySelectorAll('#orderBooksGrid .data-card').forEach(card=>{
                card.addEventListener('click', function(e){
                    if(!e.target.classList.contains('book-qty')) {
                        this.classList.toggle('selected');
                    }
                });
            });
        }, 100);
    }

    async function createOrder(){
        const customerId = parseInt(document.getElementById('orderCustomer').value);
        const items = Array.from(document.querySelectorAll('#orderBooksGrid .data-card.selected')).map(card=>{
            return {
                bookIsbn: card.dataset.isbn,
                quantity: parseInt(card.querySelector('.book-qty').value)
            };
        });
        if(!customerId || items.length===0) return alert('Selecciona cliente y al menos un libro');
        try{
            await req(`${baseUrl}/customers/${customerId}/orders`, 'POST', {customerId, items});
            closeModal();
            showMsg('Pedido creado correctamente');
            document.getElementById('getAllOrdersBtn').click();
        }catch(e){ alert(e.message); }
    }

    function displayOrdersGrid(data){
        const grid = document.getElementById('ordersGrid');
        if(!data || data.length===0) { grid.innerHTML='<div class="empty-state">No hay pedidos</div>'; return; }
        grid.innerHTML='';
        data.forEach(o=>{
            const div = document.createElement('div');
            div.className='data-card';
            let itemsHTML = o.items.map(i=>`<div class="order-item">${i.book.title} x ${i.quantity}</div>`).join('');
            div.innerHTML = `<h4>Pedido ID: ${o.id}</h4>
                         <p>Cliente: ${o.customer.name} (ID: ${o.customer.id})</p>
                         <p>Fecha: ${new Date(o.date).toLocaleString()}</p>
                         <div class="order-items">${itemsHTML}</div>
                         <div class="card-actions">
                         <button class="btn btn-small btn-danger" onclick="deleteOrder(${o.id})">üóëÔ∏è Eliminar</button>
                         </div>`;
            grid.appendChild(div);
        });
    }

    async function deleteOrder(id){
        if(!confirm('¬øEliminar este pedido?')) return;
        try{
            await req(`${baseUrl}/orders/${id}`, 'DELETE');
            showMsg('Pedido eliminado correctamente');
            document.getElementById('getAllOrdersBtn').click();
        }catch(e){ alert(e.message); }
    }

    /* ===========================
       PEDIDOS POR CLIENTE
    =========================== */
    document.getElementById('searchCustomerOrdersBtn').addEventListener('click', async ()=>{
        const cid = parseInt(document.getElementById('customerOrdersId').value);
        if(!cid) return alert('Introduce un ID v√°lido');
        try{
            const data = await req(`${baseUrl}/customers/${cid}/orders`);
            displayCustomerOrdersGrid(data);
        }catch(e){ showError('customerOrdersResult', e.message); }
    });

    function displayCustomerOrdersGrid(data){
        const grid = document.getElementById('customerOrdersGrid');
        if(!data || data.length===0) { grid.innerHTML='<div class="empty-state">No hay pedidos para este cliente</div>'; return; }
        grid.innerHTML='';
        data.forEach(o=>{
            const div = document.createElement('div');
            div.className='data-card';
            let itemsHTML = o.items.map(i=>`<div class="order-item">${i.book.title} x ${i.quantity}</div>`).join('');
            div.innerHTML = `<h4>Pedido ID: ${o.id}</h4>
                         <p>Cliente: ${o.customer.name} (ID: ${o.customer.id})</p>
                         <p>Fecha: ${new Date(o.date).toLocaleString()}</p>
                         <div class="order-items">${itemsHTML}</div>`;
            grid.appendChild(div);
        });
    }
</script>
</body>
</html>